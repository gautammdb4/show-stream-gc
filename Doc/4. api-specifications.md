# ShowStream - API Specifications

## üìã API Overview

**Document Version:** 1.0  
**API Version:** v1  
**Base URL:** `https://api.showstream.com/v1`  
**Authentication:** JWT Bearer Token  
**Response Format:** JSON  
**Date Format:** ISO 8601 (YYYY-MM-DDTHH:MM:SSZ)

## üîê Authentication & Authorization

### Authentication Headers
```http
Authorization: Bearer <jwt_token>
Content-Type: application/json
X-Request-ID: <unique_request_id>
X-Client-Version: <client_version>
```

### Response Status Codes
- `200 OK` - Successful request
- `201 Created` - Resource created successfully  
- `400 Bad Request` - Invalid request data
- `401 Unauthorized` - Invalid or missing authentication
- `403 Forbidden` - Insufficient permissions
- `404 Not Found` - Resource not found
- `409 Conflict` - Resource conflict (e.g., duplicate booking)
- `429 Too Many Requests` - Rate limit exceeded
- `500 Internal Server Error` - Server error

## üë§ User Management Service APIs

### Authentication Endpoints

#### POST /auth/register
Register a new user account

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "SecurePassword123",
  "firstName": "John",
  "lastName": "Doe",
  "phone": "+1234567890",
  "dateOfBirth": "1990-01-15",
  "agreeToTerms": true
}
```

**Response (201 Created):**
```json
{
  "success": true,
  "data": {
    "userId": 12345,
    "email": "user@example.com",
    "status": "PENDING_VERIFICATION",
    "verificationEmailSent": true
  },
  "message": "Registration successful. Please verify your email."
}
```

#### POST /auth/login
Authenticate user and get JWT token

**Request Body:**
```json
{
  "email": "user@example.com",
  "password": "SecurePassword123",
  "rememberMe": true
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "refresh_token_here",
    "tokenType": "Bearer",
    "expiresIn": 86400,
    "user": {
      "id": 12345,
      "email": "user@example.com",
      "firstName": "John",
      "lastName": "Doe",
      "roles": ["USER"]
    }
  }
}
```

#### POST /auth/social-login
Social media authentication

**Request Body:**
```json
{
  "provider": "google",
  "accessToken": "google_access_token",
  "idToken": "google_id_token"
}
```

#### POST /auth/refresh-token
Refresh JWT access token

**Request Body:**
```json
{
  "refreshToken": "refresh_token_here"
}
```

### User Profile Endpoints

#### GET /users/profile
Get current user profile

**Headers:** `Authorization: Bearer <token>`

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "id": 12345,
    "email": "user@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "phone": "+1234567890",
    "dateOfBirth": "1990-01-15",
    "avatar": "https://cdn.showstream.com/avatars/12345.jpg",
    "preferences": {
      "language": "en",
      "currency": "USD",
      "notifications": {
        "email": true,
        "sms": true,
        "push": true
      }
    },
    "loyaltyPoints": 250,
    "memberSince": "2023-01-15T10:30:00Z"
  }
}
```

#### PUT /users/profile
Update user profile

**Request Body:**
```json
{
  "firstName": "John",
  "lastName": "Smith", 
  "phone": "+1234567890",
  "preferences": {
    "language": "en",
    "notifications": {
      "email": true,
      "sms": false,
      "push": true
    }
  }
}
```

## üé≠ Event Catalog Service APIs

### Event Discovery Endpoints

#### GET /events
List events with filtering and pagination

**Query Parameters:**
- `page` (int): Page number (default: 1)
- `limit` (int): Items per page (default: 20, max: 100)
- `city` (string): Filter by city
- `category` (string): Event category (movie, concert, sports, etc.)
- `genre` (string): Event genre
- `language` (string): Event language
- `date_from` (date): Start date filter (YYYY-MM-DD)
- `date_to` (date): End date filter (YYYY-MM-DD)  
- `min_price` (decimal): Minimum price filter
- `max_price` (decimal): Maximum price filter
- `sort_by` (string): Sort by (popularity, price, date, rating)
- `sort_order` (string): Sort order (asc, desc)

**Request:**
```http
GET /events?city=mumbai&category=movie&genre=action&page=1&limit=20&sort_by=popularity&sort_order=desc
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "events": [
      {
        "id": 1001,
        "title": "Avengers: Endgame",
        "description": "The epic conclusion to the Infinity Saga",
        "category": "movie",
        "genre": ["action", "adventure", "drama"],
        "language": "english",
        "duration": 181,
        "rating": "PG-13",
        "releaseDate": "2024-04-26",
        "posterUrl": "https://cdn.showstream.com/posters/1001.jpg",
        "trailerUrl": "https://cdn.showstream.com/trailers/1001.mp4",
        "cast": ["Robert Downey Jr.", "Chris Evans", "Mark Ruffalo"],
        "director": "Anthony Russo, Joe Russo",
        "averageRating": 4.5,
        "totalRatings": 15420,
        "minPrice": 150.00,
        "maxPrice": 500.00,
        "showCount": 12,
        "nextShowTime": "2024-04-26T14:30:00Z"
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 5,
      "totalItems": 95,
      "itemsPerPage": 20,
      "hasNext": true,
      "hasPrevious": false
    },
    "filters": {
      "availableCities": ["mumbai", "delhi", "bangalore"],
      "availableGenres": ["action", "comedy", "drama", "horror"],
      "priceRange": {
        "min": 100.00,
        "max": 800.00
      }
    }
  }
}
```

#### GET /events/{eventId}
Get detailed event information

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "id": 1001,
    "title": "Avengers: Endgame",
    "description": "The epic conclusion to the Marvel Cinematic Universe's Infinity Saga brings together all the heroes for the ultimate battle against Thanos.",
    "category": "movie",
    "genre": ["action", "adventure", "drama"],
    "language": "english",
    "duration": 181,
    "rating": "PG-13",
    "releaseDate": "2024-04-26",
    "posterUrl": "https://cdn.showstream.com/posters/1001.jpg",
    "galleryImages": [
      "https://cdn.showstream.com/gallery/1001_1.jpg",
      "https://cdn.showstream.com/gallery/1001_2.jpg"
    ],
    "trailerUrl": "https://cdn.showstream.com/trailers/1001.mp4",
    "cast": [
      {
        "name": "Robert Downey Jr.",
        "role": "Tony Stark / Iron Man",
        "image": "https://cdn.showstream.com/cast/rdj.jpg"
      }
    ],
    "crew": {
      "director": ["Anthony Russo", "Joe Russo"],
      "producer": ["Kevin Feige"],
      "writer": ["Christopher Markus", "Stephen McFeely"]
    },
    "ratings": {
      "average": 4.5,
      "total": 15420,
      "distribution": {
        "5": 8500,
        "4": 4200,
        "3": 1850,
        "2": 520,
        "1": 350
      }
    },
    "reviews": [
      {
        "id": 501,
        "userId": 12345,
        "userName": "John D.",
        "rating": 5,
        "comment": "Amazing conclusion to the saga!",
        "createdAt": "2024-04-27T10:30:00Z"
      }
    ],
    "totalShows": 24,
    "isActive": true
  }
}
```

#### GET /events/{eventId}/shows
Get shows for a specific event

**Query Parameters:**
- `date` (date): Filter shows by date (YYYY-MM-DD)
- `city` (string): Filter shows by city
- `venue_id` (int): Filter shows by venue

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "eventId": 1001,
    "eventTitle": "Avengers: Endgame",
    "shows": [
      {
        "id": 2001,
        "eventId": 1001,
        "venue": {
          "id": 501,
          "name": "PVR Cinemas Phoenix",
          "address": "Phoenix MarketCity, Mumbai",
          "city": "mumbai",
          "coordinates": {
            "latitude": 19.0876,
            "longitude": 72.8906
          }
        },
        "screen": {
          "id": 201,
          "name": "Screen 1",
          "type": "IMAX",
          "capacity": 300,
          "features": ["dolby_atmos", "recliner_seats"]
        },
        "showDate": "2024-04-26",
        "showTime": "14:30:00",
        "duration": 181,
        "language": "english",
        "subtitles": ["hindi", "tamil"],
        "pricing": {
          "regular": 250.00,
          "premium": 400.00,
          "vip": 600.00
        },
        "availability": {
          "totalSeats": 300,
          "availableSeats": 157,
          "bookedSeats": 143
        },
        "bookingStatus": "OPEN",
        "facilities": ["parking", "food_court", "wheelchair_accessible"]
      }
    ],
    "groupedByDate": {
      "2024-04-26": [
        {
          "time": "14:30",
          "shows": [
            {
              "showId": 2001,
              "venueId": 501,
              "venueName": "PVR Cinemas Phoenix",
              "screenName": "Screen 1",
              "pricing": {"regular": 250.00, "premium": 400.00},
              "availability": 157
            }
          ]
        }
      ]
    }
  }
}
```

#### GET /search/events
Advanced event search

**Query Parameters:**
- `q` (string): Search query
- `filters` (object): Complex filter object
- `location` (object): Geolocation search

**Request:**
```http
GET /search/events?q=avengers&filters={"genre":["action"],"date_range":{"from":"2024-04-26","to":"2024-05-01"}}&location={"lat":19.0760,"lng":72.8777,"radius":10}
```

## üí∫ Inventory Management Service APIs

### Seat Availability Endpoints

#### GET /inventory/shows/{showId}/seats
Get seat map and availability

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "showId": 2001,
    "totalSeats": 300,
    "availableSeats": 157,
    "seatingLayout": {
      "rows": [
        {
          "rowId": "A",
          "rowLabel": "A",
          "seats": [
            {
              "seatId": "A1",
              "seatNumber": "1",
              "seatType": "regular",
              "price": 250.00,
              "status": "available",
              "position": {"x": 1, "y": 1}
            },
            {
              "seatId": "A2", 
              "seatNumber": "2",
              "seatType": "regular",
              "price": 250.00,
              "status": "booked",
              "position": {"x": 2, "y": 1}
            }
          ]
        }
      ]
    },
    "priceMap": {
      "regular": 250.00,
      "premium": 400.00,
      "vip": 600.00
    },
    "legend": {
      "available": "Available for booking",
      "booked": "Already booked",
      "locked": "Temporarily locked by other user",
      "blocked": "Not available for booking"
    },
    "lastUpdated": "2024-04-26T12:45:30Z"
  }
}
```

#### POST /inventory/lock
Lock seats for booking process

**Request Body:**
```json
{
  "showId": 2001,
  "seatIds": ["A1", "A3", "A4"],
  "userId": 12345,
  "sessionId": "session_123456",
  "lockDurationMinutes": 10
}
```

**Response (201 Created):**
```json
{
  "success": true,
  "data": {
    "lockId": "lock_789012",
    "showId": 2001,
    "seatIds": ["A1", "A3", "A4"],
    "lockedAt": "2024-04-26T12:50:00Z",
    "expiresAt": "2024-04-26T13:00:00Z",
    "status": "LOCKED",
    "totalAmount": 750.00
  }
}
```

#### PUT /inventory/release
Release seat locks

**Request Body:**
```json
{
  "lockId": "lock_789012",
  "reason": "user_cancelled"
}
```

## üé´ Booking Engine Service APIs

### Booking Management Endpoints

#### POST /bookings
Create a new booking

**Request Body:**
```json
{
  "showId": 2001,
  "seatIds": ["A1", "A3", "A4"],
  "lockId": "lock_789012",
  "customerInfo": {
    "userId": 12345,
    "email": "user@example.com",
    "phone": "+1234567890",
    "firstName": "John",
    "lastName": "Doe"
  },
  "guestInfo": [
    {
      "firstName": "Jane",
      "lastName": "Doe",
      "email": "jane@example.com"
    }
  ],
  "promoCode": "SAVE20",
  "paymentMethod": "card"
}
```

**Response (201 Created):**
```json
{
  "success": true,
  "data": {
    "bookingId": 5001,
    "bookingReference": "BK5001234567",
    "status": "PAYMENT_PENDING",
    "showDetails": {
      "eventTitle": "Avengers: Endgame",
      "venueName": "PVR Cinemas Phoenix",
      "screenName": "Screen 1",
      "showDate": "2024-04-26",
      "showTime": "14:30:00"
    },
    "seatDetails": [
      {
        "seatId": "A1",
        "seatType": "regular",
        "price": 250.00
      }
    ],
    "pricing": {
      "subtotal": 750.00,
      "bookingFee": 45.00,
      "taxes": 67.50,
      "discount": -50.00,
      "totalAmount": 812.50
    },
    "paymentToken": "payment_token_xyz123",
    "expiresAt": "2024-04-26T13:05:00Z"
  }
}
```

#### GET /bookings/{bookingId}
Get booking details

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "id": 5001,
    "bookingReference": "BK5001234567",
    "status": "CONFIRMED",
    "createdAt": "2024-04-26T12:55:00Z",
    "confirmedAt": "2024-04-26T12:58:00Z",
    "customer": {
      "name": "John Doe",
      "email": "user@example.com",
      "phone": "+1234567890"
    },
    "event": {
      "id": 1001,
      "title": "Avengers: Endgame",
      "posterUrl": "https://cdn.showstream.com/posters/1001.jpg"
    },
    "show": {
      "id": 2001,
      "date": "2024-04-26",
      "time": "14:30:00",
      "venue": "PVR Cinemas Phoenix",
      "screen": "Screen 1",
      "address": "Phoenix MarketCity, Mumbai"
    },
    "seats": [
      {
        "seatNumber": "A1",
        "seatType": "regular",
        "price": 250.00
      }
    ],
    "payment": {
      "totalAmount": 812.50,
      "paymentMethod": "card",
      "transactionId": "txn_abc123",
      "status": "PAID"
    },
    "tickets": [
      {
        "ticketId": "TKT5001001",
        "seatNumber": "A1",
        "qrCode": "https://api.showstream.com/tickets/qr/TKT5001001",
        "downloadUrl": "https://api.showstream.com/tickets/pdf/TKT5001001"
      }
    ]
  }
}
```

#### GET /bookings/user/{userId}
Get user's booking history

**Query Parameters:**
- `page` (int): Page number
- `limit` (int): Items per page
- `status` (string): Filter by booking status
- `from_date` (date): Start date filter
- `to_date` (date): End date filter

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "bookings": [
      {
        "id": 5001,
        "bookingReference": "BK5001234567",
        "status": "CONFIRMED",
        "eventTitle": "Avengers: Endgame",
        "showDate": "2024-04-26",
        "showTime": "14:30:00",
        "venueName": "PVR Cinemas Phoenix",
        "totalAmount": 812.50,
        "seatCount": 3,
        "createdAt": "2024-04-26T12:55:00Z"
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 3,
      "totalItems": 12,
      "itemsPerPage": 5
    }
  }
}
```

#### PUT /bookings/{bookingId}/cancel
Cancel a booking

**Request Body:**
```json
{
  "reason": "change_of_plans",
  "refundRequested": true
}
```

## üí≥ Payment Processing Service APIs

### Payment Processing Endpoints

#### POST /payments/initiate
Initiate payment for booking

**Request Body:**
```json
{
  "bookingId": 5001,
  "amount": 812.50,
  "currency": "INR",
  "paymentMethod": "card",
  "returnUrl": "https://app.showstream.com/payment/return",
  "cancelUrl": "https://app.showstream.com/payment/cancel"
}
```

**Response (201 Created):**
```json
{
  "success": true,
  "data": {
    "paymentId": "pay_xyz123456",
    "paymentUrl": "https://checkout.razorpay.com/pay_xyz123456",
    "paymentToken": "token_abc789",
    "expiresAt": "2024-04-26T13:15:00Z",
    "status": "INITIATED"
  }
}
```

#### POST /payments/confirm
Confirm payment completion

**Request Body:**
```json
{
  "paymentId": "pay_xyz123456", 
  "gatewayTransactionId": "gateway_txn_123",
  "gatewayResponse": {
    "status": "success",
    "amount": 812.50,
    "currency": "INR"
  }
}
```

#### POST /payments/refund
Process payment refund

**Request Body:**
```json
{
  "originalPaymentId": "pay_xyz123456",
  "refundAmount": 812.50,
  "reason": "booking_cancelled",
  "refundMethod": "original_payment_method"
}
```

## üì¢ Notification Service APIs

### Notification Management Endpoints

#### POST /notifications/send
Send notification to user

**Request Body:**
```json
{
  "userId": 12345,
  "templateId": "booking_confirmation",
  "channels": ["email", "sms"],
  "data": {
    "bookingReference": "BK5001234567",
    "eventTitle": "Avengers: Endgame",
    "showDate": "2024-04-26",
    "showTime": "14:30"
  },
  "priority": "high",
  "scheduleAt": "2024-04-26T13:00:00Z"
}
```

#### GET /notifications/user/{userId}
Get user notifications

**Query Parameters:**
- `page` (int): Page number
- `limit` (int): Items per page  
- `read` (boolean): Filter by read status
- `type` (string): Filter by notification type

## üìä Analytics Service APIs

### Analytics & Reporting Endpoints

#### GET /analytics/dashboard
Get dashboard metrics

**Query Parameters:**
- `date_from` (date): Start date for metrics
- `date_to` (date): End date for metrics
- `granularity` (string): Data granularity (hourly, daily, weekly)

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "summary": {
      "totalBookings": 2547,
      "totalRevenue": 1247850.00,
      "totalUsers": 8945,
      "averageBookingValue": 489.75
    },
    "performance": {
      "bookingSuccessRate": 94.2,
      "averageResponseTime": 185,
      "systemAvailability": 99.97,
      "errorRate": 0.08
    },
    "trends": {
      "bookingsGrowth": 15.7,
      "revenueGrowth": 22.3,
      "userGrowth": 12.1
    },
    "topEvents": [
      {
        "eventId": 1001,
        "title": "Avengers: Endgame", 
        "bookings": 425,
        "revenue": 187500.00
      }
    ]
  }
}
```

## üîç Common Response Patterns

### Success Response Format
```json
{
  "success": true,
  "data": {},
  "message": "Operation successful",
  "timestamp": "2024-04-26T12:00:00Z",
  "requestId": "req_123456"
}
```

### Error Response Format  
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid request data",
    "details": [
      {
        "field": "email",
        "message": "Email format is invalid"
      }
    ]
  },
  "timestamp": "2024-04-26T12:00:00Z",
  "requestId": "req_123456"
}
```

### Pagination Response Format
```json
{
  "success": true,
  "data": {
    "items": [],
    "pagination": {
      "currentPage": 1,
      "totalPages": 10,
      "totalItems": 195,
      "itemsPerPage": 20,
      "hasNext": true,
      "hasPrevious": false
    }
  }
}
```

## üîÑ WebSocket APIs

### Real-time Updates

#### Connection Endpoint
```
wss://api.showstream.com/v1/ws?token=<jwt_token>
```

#### Seat Availability Updates
```json
{
  "type": "SEAT_UPDATE",
  "showId": 2001,
  "data": {
    "seatId": "A5",
    "previousStatus": "available",
    "newStatus": "locked",
    "lockedBy": "user_67890",
    "timestamp": "2024-04-26T13:00:00Z"
  }
}
```

#### Booking Status Updates
```json
{
  "type": "BOOKING_STATUS",
  "bookingId": 5001,
  "data": {
    "status": "CONFIRMED",
    "timestamp": "2024-04-26T12:58:00Z",
    "message": "Your booking has been confirmed!"
  }
}
```

---

*This API specification provides comprehensive documentation for all ShowStream platform services, enabling frontend developers and third-party integrations to interact effectively with the system.*